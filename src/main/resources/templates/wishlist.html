<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Wishlist</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" href="/products">Back to Products</a>
        <div class="navbar-nav ms-auto">
            <form th:action="@{/logout}" method="post" class="d-inline">
                <button type="submit" class="btn btn-outline-danger">Logout</button>
            </form>
        </div>
    </div>
</nav>
<div class="container py-5">
    <h1>Your Wishlist</h1>

    <div th:if="${#lists.isEmpty(wishlist.items)}" class="alert alert-info">
        Your wishlist is empty
    </div>

    <div th:if="${not #lists.isEmpty(wishlist.items)}" class="table-responsive">
        <table class="table">
            <thead>
            <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item : ${wishlist.items}">
                <td th:text="${item.product.name}">Product Name</td>
                <td th:text="${'$' + item.product.price}">Price</td>
                <td>
                    <button class="btn btn-primary btn-sm me-2"
                            th:onclick="'addToCart(' + ${item.product.id} + ')'">
                        Add to Cart
                    </button>
                    <button class="btn btn-danger btn-sm"
                            th:onclick="'removeFromWishlist(' + ${item.product.id} + ')'">
                        Remove
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <a href="/products" class="btn btn-primary">Continue Shopping</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function removeFromWishlist(productId) {
        fetch(`/wishlist/remove/${productId}`, {
            method: 'DELETE'
        })
            .then(() => window.location.reload())
            .catch(error => alert('Error removing item from wishlist'));
    }

    function addToCart(productId) {
        const csrfToken = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');
        fetch(`/cart/add/${productId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': csrfToken || ''
            },
            credentials: 'include'
        })
            .then(response => {
                if (response.ok) {
                    alert('Product added to cart');
                } else {
                    throw new Error('Failed to add to cart');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert(error.message || 'Error adding to cart');
            });
    }
</script>
</body>
</html>